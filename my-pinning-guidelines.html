<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>My Pinning Guidelines - BackSlasher</title>
<meta name="description" content="In my previous post about pinning I talked about the reasons to configure apt pinning. This post details my logic about what and how to pin.">


  <meta name="author" content="Nitzan">
  
  <meta property="article:author" content="Nitzan">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="BackSlasher">
<meta property="og:title" content="My Pinning Guidelines">
<meta property="og:url" content="https://blog.backslasher.net/my-pinning-guidelines.html">


  <meta property="og:description" content="In my previous post about pinning I talked about the reasons to configure apt pinning. This post details my logic about what and how to pin.">







  <meta property="article:published_time" content="2014-06-14T00:00:00+03:00">






<link rel="canonical" href="https://blog.backslasher.net/my-pinning-guidelines.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Nitzan",
      "url": "https://blog.backslasher.net/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="BackSlasher Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          BackSlasher
          <span class="site-subtitle">I fix things</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/hireme/">Hire Me</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/nitz.jpg" alt="Nitzan" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Nitzan</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>If this prod is rocking, don’t come a-knocking</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Israel</span>
        </li>
      

      
        
          
            <li><a href="https://backslasher.net" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Backslasher</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="My Pinning Guidelines">
    <meta itemprop="description" content="In my previous post aboutpinning I talked about the reasons to configure apt pinning.This post details my logic about what and how to pin.">
    <meta itemprop="datePublished" content="2014-06-14T00:00:00+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">My Pinning Guidelines
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In my <a href="|filename|/why-pinning.md">previous post</a> about
pinning I talked about the reasons to configure apt pinning.<br />
This post details my logic about what and how to pin.</p>

<h3 id="pinning-technicalities">Pinning technicalities</h3>
<h4 id="how-pinning-is-done">How pinning is done</h4>
<p>The best way to pin stuff is to add files in <code class="language-plaintext highlighter-rouge">/etc/apt/preferences.d/</code><br />
Those files are parsed whenever the package cache is updated (e.g. <code class="language-plaintext highlighter-rouge">apt-get
update</code>), and rules inside the files are applied to the packages.<br />
You can view the official documentation about pinning using:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man apt_preferences
</code></pre></div></div>

<h4 id="what-can-you-pin">What can you pin</h4>
<p>Pinning is done on a per-option basis (package+version+origin), meaning
you can pin according to the different fields of an option. The field
details start at about line 289 in the <code class="language-plaintext highlighter-rouge">apt_preferences</code> man page.<br />
Most times, pinning is done according to a specific origin (as in
“pinning a repository”) or according to a name and version ( as in
“pinning a version”). You can obviously mix and match for your needs,
but test the results using:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
apt-cache policy PACKAGENAME
</code></pre></div></div>

<h3 id="what-to-pin">What to pin</h3>
<p>There is no “right way” to pin packages (only wrong ones).<br />
Pinning is supposed to reflect the administrator’s opinion of “which version of the
package is best”, so think of what rules you’d follow if you installed
all packages by hand, and try and see how you can explain that to apt.<br />
These are some strategies I thought of.</p>

<h4 id="latest-is-best-default">Latest is best (default)</h4>
<p>The default behaviour is preferring the latest version available. When
installing packages only from the stable Debian repositories, this is a
good idea since the only updates are critical bug and security fixes.<br />
It also saves you the trouble of keeping the package version locked (and
needing to update the lock later).</p>

<h4 id="keeping-a-certain-version">Keeping a certain version</h4>
<p>Some software repositories offer several versions of the same package,
and let you choose which version to install.<br />
Pinning the package to a specific version will tell apt to prefer  that version if available.<br />
<strong>Note:</strong> You might encounter dependency issues (see “version pinning and
dependencies” for the problem and possible solutions).</p>

<h4 id="keeping-a-certain-majorminor-version">Keeping a certain major/minor version</h4>
<p>Like to the previous example, you may want to hold apt to a
specific major/minor version (e.g. puppet 3.1), but have it upgrade to
the highest build/revision (to allow bug/security updates that don’t
modify behaviour). To do so, pin the package to a
<a href="http://en.wikipedia.org/wiki/Globbing">globbed</a> version, like <code class="language-plaintext highlighter-rouge">3.1.*</code></p>

<h4 id="a-last-resort-repository">A last resort repository</h4>
<p>Some packages aren’t available in your official distribution’s
repository, but are available on other repositories.<br />
For instance, <a href="http://haproxy.1wt.eu/">HAProxy</a> isn’t available on the
Debian stable repo, but is available on the Debian <a href="http://backports.debian.org/">backports
repo</a>. If we just add the backports
repository, apt will upgrade everything to the backports version (since
every package option there has the same priority and a higher version
number).<br />
If we instead add the repo and pin it to a lower priority, apt will only
take from it packages it can’t find anywhere else.</p>

<h4 id="a-high-priority-repository">A high priority repository</h4>
<p>Similar to the last example, you could have a company repo with packages
compiled especially for you - passing additional security audits,
containing critical features, etc. You want apt to prefer package
options in that repo over “normal” options, even if their version number
is lower. To do so, pin the repository to a higher priority than the
default. Remember that you have to keep this repository up to date,
because apt will avoid applying upgrades found in the “normal”
repositories.</p>

<h3 id="other-points-to-consider">Other points to consider</h3>
<p>These aren’t pinning strategies, but rather tips I picked up along they
way.</p>

<h4 id="which-priority-numbers-do-i-choose">Which priority numbers do I choose?</h4>
<p>The examples don’t contain actual priority numbers, since these are very delicate.<br />
Priority numbers do more than tell apt which option to prefer</p>
<ul>
  <li>
    <p>they modify apt’s treatment of the package even further. The full
documentation is in the <code class="language-plaintext highlighter-rouge">apt_preferences</code> man page, but for instance:</p>
  </li>
  <li>Priorities over 1000 instruct apt to install this package even if it
constitutes a downgrade</li>
  <li>Priorities lower than 100 will cause apt to only use this version if the package isn’t installed at all (no upgrades).</li>
</ul>

<p>So choose your numbers carefully - if you don’t want apt to change its
behaviour, stick to numbers around 500 (the default value). </p>

<h4 id="version-pinning-and-dependencies">Version pinning and dependencies</h4>

<p>When installing package dependencies (packages that are required for the
one you requested), to packages pinned by version, apt might behave
strangely:</p>

<ul>
  <li>The package may require a specific version of the dependency (for
example, <code class="language-plaintext highlighter-rouge">puppet</code> 3.3.1 requires <code class="language-plaintext highlighter-rouge">puppet-common</code> <strong>exactly</strong> in version
3.3.1)</li>
  <li>When reviewing the dependency installation options, sorted by
priority and version, the first result may be a different version
(e.g. version 3.6.2)</li>
</ul>

<p>In this situation, apt is in a pickle - it can’t satisfy the dependency
requirement by installing the highest-priority option.<br />
Different apt front-ends treat this dilemma differently:</p>

<ul>
  <li>
    <p><strong>Apt-get</strong> gives up, giving a weird error like <code class="language-plaintext highlighter-rouge">X: depends
Y(=LOWVERSION) but HIGHVERSION is to be installed</code>, combined with the
accusing statement <code class="language-plaintext highlighter-rouge">You have held broken packages</code>.</p>

    <p><img src="/assets/my-pinning-guidelines/apt-pinning-issue.png" alt="" /></p>
  </li>
  <li>
    <p><strong>Aptitude</strong> offers several solutions (aptitude always does), one of
them is what we want (installing the dependency):</p>

    <p><img src="/assets/my-pinning-guidelines/aptitude-pinning-puppet.jpg" alt="" /></p>
  </li>
  <li>
    <p>The <strong>python apt module</strong> will throw an exception, telling you the
automatic dependency resolution failed.</p>

    <p><img src="/assets/my-pinning-guidelines/python-apt-pinning.png" alt="" /></p>
  </li>
</ul>

<p><strong>The solution</strong> to this issue is to study the failed dependencies, and
pin them in the same way. Use aptitude’s interactive UI to check for the
dependencies of your package, and find the ones with version constraints
(<code class="language-plaintext highlighter-rouge">=X.YY.ZZZZ</code>). Those are the ones you’ll need to pin.</p>

<p><img src="/assets/my-pinning-guidelines/aptitude-depends.png" alt="" /></p>

<p>Remember - wrong pinning could negatively impact your system’s security,
performance, stability etc. Make sure you plan it carefully!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#apt" class="page__taxonomy-item" rel="tag">Apt</a><span class="sep">, </span>
    
      <a href="/tags/#debian" class="page__taxonomy-item" rel="tag">Debian</a><span class="sep">, </span>
    
      <a href="/tags/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      <a href="/tags/#security" class="page__taxonomy-item" rel="tag">Security</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#foss" class="page__taxonomy-item" rel="tag">FOSS</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-06-14T00:00:00+03:00">June 14, 2014</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/adding-repositories-for-inspection.html" class="pagination--pager" title="Adding Repositories for Inspection
">Previous</a>
    
    
      <a href="/why-pinning.html" class="pagination--pager" title="Why Pinning
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <!-- start custom comments snippet -->
<div id="graphcomment"></div>
<script type="text/javascript">

  /* - - - CONFIGURATION VARIABLES - - - */

  // make sure the id is yours
  window.gc_params = {
    graphcomment_id: 'Backslasher-net',

    // if your website has a fixed header, indicate it's height in pixels
    fixed_header_height: 0,
  };

  /* - - - DON'T EDIT BELOW THIS LINE - - - */

  
  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.src = 'https://graphcomment.com/js/integration.js?' + Math.round(Math.random() * 1e8);
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();

</script>
<!-- end custom comments snippet -->

  
</div>

    
  </article>

  
  
    <div class="page__related">
      <div align="center" style="margin: 1em 0;">
        <ins class="adsbygoogle"
              style="display:block; border-bottom: initial;"
              data-ad-client="ca-pub-7328585512091257"
              data-ad-slot="3049671934"
              data-ad-format="auto"
              data-full-width-responsive="true"></ins>
      </div>
      <h2 class="page__related-title">You May Also Enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/openwrt-switcher.html" rel="permalink">Bridging Switcher’s UDP over OpenWRT
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Seems like I’m doing this setup once every 3 years, then forget about it until the next time it breaks.
I hope this is the last time I’m rediscovering this.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/invalid-number-nov.html" rel="permalink">Invalid number: Nov
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">One of my current projects is migrating a big Java project from Java 8 to a supported version. Since we’re doing small, stable steps, we started with Java 11...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/no-dst.html" rel="permalink">We don’t do DST at this company
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Once, a long time ago, I used to have a consulting gig in some big enterprise-y company. It had a lot of unique challenges, being disconnected from the inter...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/jar-patch.html" rel="permalink">Patching a Java JAR
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I’m working with a company that uses smart IoT devices produced far away.
The main troubleshooting tool is a Java utility provided by the manufacturer.
This ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

      <div align="center" style="margin: 1em 0;">
        <ins class="adsbygoogle"
             style="display:block; border-bottom: initial;"
             data-ad-client="ca-pub-7328585512091257"
             data-ad-slot="3049671934"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Nitzan. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S2WYJL3VQ7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S2WYJL3VQ7', { 'anonymize_ip': true});
</script>






    <!-- start custom comments scripts -->

<!-- end custom comments scripts -->





    <style>
      .google-auto-placed {
        margin: 2em auto;
      }
    </style>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

  </body>
</html>
