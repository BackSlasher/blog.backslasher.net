<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Get-BigDirectories - BackSlasher</title>
<meta name="description" content="Note: This script is better than just ls -rec | measure, because measure measures only one field, and when iterating over many files and directories, every iteration counts.">


  <meta name="author" content="Nitzan">
  
  <meta property="article:author" content="Nitzan">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="BackSlasher">
<meta property="og:title" content="Get-BigDirectories">
<meta property="og:url" content="https://blog.backslasher.net/get-bigdirectories.html">


  <meta property="og:description" content="Note: This script is better than just ls -rec | measure, because measure measures only one field, and when iterating over many files and directories, every iteration counts.">







  <meta property="article:published_time" content="2010-07-29T00:00:00+03:00">






<link rel="canonical" href="https://blog.backslasher.net/get-bigdirectories.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Nitzan",
      "url": "https://blog.backslasher.net/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="BackSlasher Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          BackSlasher
          <span class="site-subtitle">I fix things</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/nitz.jpg" alt="Nitzan" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Nitzan</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>If this prod is rocking, don’t come a-knocking</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Israel</span>
        </li>
      

      
        
          
            <li><a href="https://backslasher.net" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Backslasher</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Get-BigDirectories">
    <meta itemprop="description" content="Note: This script is better than just ls -rec | measure, because measure measures only one field, and when iterating over many files and directories, every iteration counts.">
    <meta itemprop="datePublished" content="2010-07-29T00:00:00+03:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Get-BigDirectories
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><strong>Note</strong>: This script is better than just <code class="language-plaintext highlighter-rouge">ls -rec | measure</code>, because measure measures only one field, and when iterating over many files and directories, every iteration counts.</p>

<p>Whenever our roaming profiles folder gets too big, we have to prune the
profiles that are both old and heavy. Using windows explorer, it’s easy
enough to see the size of a specific folder, but the <code class="language-plaintext highlighter-rouge">last modified</code>
date is misleading, because files in that folder may have changed while
the folder stayed the same. PowerShell to the rescue!</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">&lt;#
</span><span class="cs">.SYNOPSIS</span><span class="cm">
Searches and possibly deletes old and big folders
 
</span><span class="cs">.DESCRIPTION</span><span class="cm">
This script recursively checks folders for files, marking for every first-level folder
the sum of all of it's files size, and the latest WriteTime of a file.
If required, the script deletes folders that are both old enough and big enough.
 
</span><span class="cs">.PARAMETER</span><span class="cm"> Path
The location of the folder to scan. Default is current folder.
 
</span><span class="cs">.PARAMETER</span><span class="cm"> Delete
Whether to delete the matching folders, or just to point them out
 
</span><span class="cs">.PARAMETER</span><span class="cm"> MinSizeMB
The minimum size of a folder to be deleted, in MBs. Default is 5MB
 
</span><span class="cs">.PARAMETER</span><span class="cm"> MinYearsOld
The minimum age of a folder to be deleted, in years. Default is 1 year
 
</span><span class="cs">.LINK</span><span class="cm">
My Blog: http://OneBoredAdmin.blogspot.com
#&gt;</span><span class="w">
</span><span class="kr">param</span><span class="p">(</span><span class="w">
</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$Path</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span><span class="w">
</span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$Delete</span><span class="o">=</span><span class="bp">$false</span><span class="p">,</span><span class="w">
</span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$MinSizeMB</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w">
</span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$MinYearsOld</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">pushd</span><span class="w"> </span><span class="nv">$Path</span><span class="w">
</span><span class="nv">$res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">%</span><span class="p">{</span><span class="w">
 
</span><span class="nv">$totalSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="nv">$lastModified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">LastWriteTime</span><span class="p">;</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">%</span><span class="p">{</span><span class="nv">$totalSize</span><span class="o">+=</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Length</span><span class="p">;</span><span class="kr">if</span><span class="p">(</span><span class="nv">$lastModified</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">LastWriteTime</span><span class="p">){</span><span class="nv">$lastModified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">LastWriteTime</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">      
</span><span class="bp">$_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">noteproperty</span><span class="w"> </span><span class="s1">'TotalSizeMB'</span><span class="w"> </span><span class="p">((</span><span class="nv">$totalSize</span><span class="n">/1024/1024</span><span class="p">)</span><span class="o">.</span><span class="nf">toString</span><span class="p">(</span><span class="s1">'F'</span><span class="p">));</span><span class="w">
</span><span class="bp">$_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">noteproperty</span><span class="w"> </span><span class="s1">'LastModified'</span><span class="w"> </span><span class="nv">$lastModified</span><span class="p">;</span><span class="w">
</span><span class="nv">$del</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((([</span><span class="n">int</span><span class="p">]</span><span class="bp">$_</span><span class="o">.</span><span class="nf">TotalSizeMB</span><span class="p">)</span><span class="w"> </span><span class="o">-ge</span><span class="w"> </span><span class="nv">$MinSizeMB</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">LastModified</span><span class="o">.</span><span class="nf">addYears</span><span class="p">(</span><span class="nv">$MinYearsOld</span><span class="p">)</span><span class="w"> </span><span class="o">-le</span><span class="w"> </span><span class="p">[</span><span class="n">datetime</span><span class="p">]::</span><span class="n">now</span><span class="p">))</span><span class="w">
</span><span class="bp">$_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Add-Member</span><span class="w"> </span><span class="nt">-MemberType</span><span class="w"> </span><span class="nx">noteproperty</span><span class="w"> </span><span class="s1">'ShouldDelete'</span><span class="w"> </span><span class="nv">$del</span><span class="p">;</span><span class="w">
</span><span class="kr">if</span><span class="p">(</span><span class="nv">$Delete</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$del</span><span class="p">){</span><span class="n">rm</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-Force</span><span class="p">;</span><span class="bp">$_</span><span class="p">;}</span><span class="w">
</span><span class="bp">$_</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tee</span><span class="w"> </span><span class="nt">-var</span><span class="w"> </span><span class="s1">'res'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="nx">TotalSizeMB</span><span class="p">,</span><span class="nx">LastModified</span><span class="p">,</span><span class="nx">ShouldDelete</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">out-gridview</span><span class="w">
</span><span class="nx">popd</span><span class="p">;</span><span class="w">
</span></code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#filesystem" class="page__taxonomy-item" rel="tag">FileSystem</a><span class="sep">, </span>
    
      <a href="/tags/#powershell" class="page__taxonomy-item" rel="tag">PowerShell</a><span class="sep">, </span>
    
      <a href="/tags/#scripts" class="page__taxonomy-item" rel="tag">Scripts</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#microsoft" class="page__taxonomy-item" rel="tag">Microsoft</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2010-07-29T00:00:00+03:00">July 29, 2010</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/auto-sorting-computers-in-wsus.html" class="pagination--pager" title="Auto-Sorting Computers in WSUS
">Previous</a>
    
    
      <a href="/2008-clusters-cant-change-password.html" class="pagination--pager" title="2008 Clusters can’t change password
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <!-- start custom comments snippet -->
<div id="graphcomment"></div>
<script type="text/javascript">

  /* - - - CONFIGURATION VARIABLES - - - */

  // make sure the id is yours
  window.gc_params = {
    graphcomment_id: 'Backslasher-net',

    // if your website has a fixed header, indicate it's height in pixels
    fixed_header_height: 0,
  };

  /* - - - DON'T EDIT BELOW THIS LINE - - - */

  
  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.src = 'https://graphcomment.com/js/integration.js?' + Math.round(Math.random() * 1e8);
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();

</script>
<!-- end custom comments snippet -->

  
</div>

    
  </article>

  
  
    <div class="page__related">
      <div align="center" style="margin: 1em 0;">
        <ins class="adsbygoogle"
              style="display:block; border-bottom: initial;"
              data-ad-client="ca-pub-7328585512091257"
              data-ad-slot="3049671934"
              data-ad-format="auto"
              data-full-width-responsive="true"></ins>
      </div>
      <h2 class="page__related-title">You May Also Enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/android-app-sizes.html" rel="permalink">Get Android App Sizes with ADB
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Upon receiving a notification from my NVidia Shield indicating that it was running low on storage space, I attempted to use the device’s interface to trouble...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/3-loc-760h.html" rel="permalink">Changed 3 lines of code, saved 760 server hours per month
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Act 1, where I write Java
In the past, I had the opportunity to assist a team in developing an Android application and a Java server. While my primary focus ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/sapling-commands.html" rel="permalink">Sapling Commands
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Sapling (the Facebook-released SCM) is great, but the docs are not-great.
I thought I’d list some commands it took me a while to undertand, for me and for ot...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/foia-calendars-pt1.html" rel="permalink">Processing Israeli FOIA calendars, Part 1
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Preface

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

      <div align="center" style="margin: 1em 0;">
        <ins class="adsbygoogle"
             style="display:block; border-bottom: initial;"
             data-ad-client="ca-pub-7328585512091257"
             data-ad-slot="3049671934"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Nitzan. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <script>
  window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
  ga('create','','auto');
  ga('set', 'anonymizeIp', false);
  ga('send','pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>






    <!-- start custom comments scripts -->

<!-- end custom comments scripts -->





    <style>
      .google-auto-placed {
        margin: 2em auto;
      }
    </style>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

  </body>
</html>
